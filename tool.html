<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bear è²¡å‹™è¨ºæ–·å®¤ 6.2</title>
    <link rel="icon" href="favicon.png" type="image/png">
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Noto+Serif+TC:wght@400;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            /* Bear.saving å“ç‰Œè‰²ç³» */
            --bg-color: #fcfbf9;        /* ç±³ç™½èƒŒæ™¯ */
            --text-primary: #5a4d41;    /* æ·±æ£•æ–‡å­— */
            --text-secondary: #968c83;  /* æ·ºæ£•å‰¯æ¨™ */
            --accent: #b08d85;          /* ä¹¾ç‡¥ç«ç‘°è‰² (å¼·èª¿è‰²) */
            --input-bg: #fdfbf7;        /* è¼¸å…¥æ¡†åº•è‰² */
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(90, 77, 65, 0.08);
            --danger: #e57373;          /* è­¦ç¤ºç´… */
            --success: #81c784;         /* å®‰å…¨ç¶  */
        }

        body {
            font-family: 'Montserrat', 'Noto Serif TC', serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0; padding: 0;
            min-height: 100vh;
            display: flex; flex-direction: column;
        }

        /* å°è¦½åˆ— */
        nav {
            padding: 20px 30px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(252, 251, 249, 0.95); position: fixed; top: 0; width: 100%; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .nav-logo { font-family: 'Playfair Display', serif; font-size: 1.2rem; font-weight: 600; color: var(--text-primary); text-decoration: none; }
        .nav-back { font-size: 0.9rem; color: var(--text-secondary); text-decoration: none; display: flex; align-items: center; gap: 5px; transition: 0.3s; }
        .nav-back:hover { color: var(--accent); }

        /* ä¸»å®¹å™¨ */
        .main-wrapper {
            flex: 1; display: flex; justify-content: center; align-items: center;
            padding: 100px 20px 40px; /* é¿é–‹å°è¦½åˆ— */
        }

        .container {
            background-color: var(--white);
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            width: 100%; max-width: 600px;
            text-align: center;
            position: relative;
            border: 1px solid rgba(176, 141, 133, 0.1);
        }

        h1 { 
            font-family: 'Playfair Display', serif; 
            font-size: 1.8rem; margin-bottom: 10px; color: var(--accent); 
        }

        /* è¼¸å…¥å€å¡Š */
        .question { margin-bottom: 25px; text-align: left; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); }
        
        input, select { 
            width: 100%; padding: 12px; 
            border: 1px solid #e0e0e0; border-radius: 10px; 
            box-sizing: border-box; font-size: 1rem; outline: none; 
            background-color: var(--input-bg); color: var(--text-primary);
            font-family: 'Montserrat', sans-serif;
            transition: 0.3s;
        }
        input:focus, select:focus { border-color: var(--accent); background: #fff; }

        /* è² å‚µæ˜ç´°å¡ç‰‡ */
        .debt-item { 
            background: var(--input-bg); padding: 20px; 
            border-radius: 15px; margin-bottom: 15px; 
            border: 1px dashed var(--accent);
        }
        .debt-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .grid-label { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 4px; text-align: left; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { 
            background: var(--text-primary); color: white; border: none; 
            padding: 15px 30px; border-radius: 50px; font-size: 1rem; cursor: pointer; 
            width: 100%; margin-top: 15px; font-weight: 600; transition: 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); letter-spacing: 1px;
        }
        .btn:hover { background: var(--accent); transform: translateY(-2px); }
        
        .btn-outline {
            background: transparent; border: 1px dashed var(--accent); color: var(--accent);
            width: 100%; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 0.9rem;
            transition: 0.3s;
        }
        .btn-outline:hover { background: var(--input-bg); }

        .btn-warning { background: var(--danger); }
        .btn-info { background: #78909c; }

        /* çµæœå€å¡Š */
        .hidden { display: none; }
        .diag-box { 
            text-align: left; padding: 20px; border-radius: 15px; 
            margin-bottom: 20px; line-height: 1.6; border: 1px solid #eee;
            background: #fff; 
        }
        .low-debt-info { border-left: 4px solid var(--success); }
        .high-debt-warning { border-left: 4px solid var(--danger); background: #fff5f5; }

        .debt-summary-card { 
            background: var(--text-primary); color: #fff; 
            padding: 25px; border-radius: 15px; margin-bottom: 25px; 
            display: flex; justify-content: space-around; text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        .summary-label { font-size: 0.85rem; opacity: 0.8; margin-bottom: 5px; }
        .summary-value { font-size: 1.4rem; font-weight: 600; color: #f5efe6; font-family: 'Playfair Display', serif; }

        /* é ç®—å¡ç‰‡èˆ‡åœ–è¡¨ */
        .budget-card { 
            background: var(--input-bg); border-radius: 15px; 
            padding: 25px; margin-top: 20px; text-align: left; 
        }
        .chart-container {
            position: relative; 
            height: 250px; 
            width: 100%; 
            margin: 20px 0;
            display: flex; justify-content: center;
        }
        .budget-row { 
            display: flex; justify-content: space-between; 
            padding: 10px 0; border-bottom: 1px solid #eee; 
            align-items: center; font-size: 0.95rem;
        }
        .budget-row:last-child { border-bottom: none; }
        .budget-row b { color: var(--text-primary); font-weight: 600; }

        /* è¡Œå‹•æŒ‰éˆ• */
        .action-container { display: flex; flex-direction: column; gap: 10px; margin-top: 25px; align-items: center; }
        .action-btn { 
            text-decoration: none; background: var(--accent); color: white; 
            padding: 12px 25px; border-radius: 50px; width: 100%; 
            font-weight: 600; text-align: center; font-size: 0.95rem; 
            transition: 0.3s;
        }
        .action-btn:hover { background: var(--text-primary); }
        .video-btn { background: #e1306c; } /* IG è‰² */

        /* ç¸½å ±å‘Šè¡¨æ ¼ */
        .full-report { text-align: left; background: #fff; padding: 20px; border-radius: 15px; border: 1px solid #eee; }
        .report-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed #eee; font-size: 1rem; }
        .report-title { color: var(--text-secondary); }

        .debt-table-wrapper { width: 100%; overflow-x: auto; margin-top: 15px; }
        .debt-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; min-width: 450px; }
        .debt-table th { background: var(--input-bg); text-align: left; padding: 10px; border-bottom: 2px solid var(--accent); color: var(--text-primary); }
        .debt-table td { padding: 10px; border-bottom: 1px solid #eee; color: var(--text-secondary); }
        .save-money { color: var(--success); font-weight: bold; }
        
        /* æ¨è–¦è™•æ–¹ç±¤ */
        .prescription-box {
            margin-top: 20px; padding: 15px; border-radius: 12px;
            background: #fff0f0; border: 1px solid #ffcdd2;
            text-align: left; font-size: 0.9rem; color: #b71c1c;
        }
        .prescription-title { font-weight: bold; margin-bottom: 5px; display: flex; align-items: center; gap: 5px; }

    </style>
</head>
<body>

    <nav>
        <a href="index.html" class="nav-back"><i class="fas fa-arrow-left"></i> å›é¦–é </a>
        <a href="index.html" class="nav-logo">Bear.saving</a>
        <div style="width: 70px;"></div>
    </nav>

    <div class="main-wrapper">
        
        <div class="container" id="page1">
            <h1>Financial Diagnosis</h1>
            <p style="color:var(--text-secondary); margin-bottom:30px; font-size:0.9rem;">Bear è²¡å‹™è¨ºæ–·å®¤ 6.2 | è¦–è¦ºåŒ–æ·±åº¦æª¢æ¸¬</p>

            <div id="quiz-form">
                <div class="question">
                    <label>1. ç›®å‰æœ‰ç„¡è² å‚µï¼Ÿ</label>
                    <select id="hasDebt" onchange="toggleDebtSection()">
                        <option value="no">ç„¡è² å‚µ (ä¸€èº«è¼•âœ¨)</option>
                        <option value="yes">æˆ‘æœ‰è² å‚µ (æƒ³é¢å°ğŸ’ª)</option>
                    </select>
                </div>

                <div id="emergency-fund-group" class="question">
                    <label>2. æ˜¯å¦å­˜æ»¿ 3-6 å€‹æœˆç”Ÿæ´»é å‚™é‡‘ï¼Ÿ</label>
                    <select id="hasEmergencyFund">
                        <option value="no">å°šæœªå­˜æ»¿</option>
                        <option value="yes">å·²ç¶“å­˜æ»¿äº†</option>
                    </select>
                </div>

                <div id="debt-input-group" style="display:none;">
                    <label>2. è² å‚µæ˜ç´° (åˆ—å‡ºé …ç›®)</label>
                    <div id="debt-list">
                        <div class="debt-item">
                            <div class="debt-grid">
                                <div><div class="grid-label">é …ç›®åç¨±</div><input type="text" class="d-name" placeholder="ä¾‹:å­¸è²¸"></div>
                                <div><div class="grid-label">å¹´åˆ©ç‡ %</div><input type="number" step="0.1" class="d-rate" placeholder="0.0"></div>
                                <div><div class="grid-label">æ¯æœˆç¹³æ¬¾</div><input type="number" class="d-pay" placeholder="0"></div>
                                <div><div class="grid-label">å‰©é¤˜æœŸæ•¸</div><input type="number" class="d-months" placeholder="0"></div>
                            </div>
                        </div>
                    </div>
                    <button class="btn-outline" onclick="addDebt()">ï¼‹ æ–°å¢è² å‚µé …ç›®</button>
                </div>

                <div class="question" style="margin-top:25px;">
                    <label>3. æ¯æœˆç¸½æ”¶å…¥ (Income)</label>
                    <input type="number" id="monthlyIncome" placeholder="è«‹è¼¸å…¥é‡‘é¡">
                </div>

                <button class="btn" onclick="processDiagnosis()">é–‹å§‹è¨ºæ–· <i class="fas fa-chart-pie" style="margin-left:5px;"></i></button>
            </div>

            <div id="result" class="hidden">
                <div id="debt-overview-area"></div>
                <div id="diagnosis-area"></div>
                
                <div id="budget-area"></div>
                
                <button id="over50-btn" class="btn btn-warning" onclick="showSurvivalPage()">ğŸ†˜ å›ºå®šæ”¯å‡º > ç¸½æ”¶å…¥ 50%ï¼Ÿé»æ­¤è™•</button>
                <button id="summary-report-btn" class="btn btn-info hidden" onclick="showFullReport()">ğŸ“Š æŸ¥çœ‹æˆ‘çš„è²¡å‹™ç¸½å ±å‘Š</button>
                
                <div id="result-action" class="action-container"></div>
                
                <button class="btn-outline" style="margin-top:30px;" onclick="location.reload()">é‡æ–°è¨ˆç®—</button>
            </div>
        </div>

        <div class="container hidden" id="page2">
            <h1>Fixed Cost Check</h1>
            <p style="color:var(--text-secondary); margin-bottom:20px;">å›ºå®šæ”¯å‡ºæ·±åº¦ç›¤é»</p>
            
            <div id="fixed-exp-list">
                <div class="debt-item">
                    <div class="debt-grid">
                        <div><div class="grid-label">æ”¯å‡ºé …ç›®</div><input type="text" class="f-name" placeholder="ä¾‹:æˆ¿ç§Ÿ"></div>
                        <div><div class="grid-label">é‡‘é¡</div><input type="number" class="f-pay" placeholder="0"></div>
                    </div>
                </div>
            </div>
            <button class="btn-outline" onclick="addFixedExp()">ï¼‹ æ–°å¢æ”¯å‡ºé …ç›®</button>
            
            <div id="survival-result" class="diag-box" style="background:#fffaf0; display:none; margin-top:20px; border-left:4px solid var(--accent);"></div>
            
            <button class="btn" onclick="calcSurvival()">é‡æ–°ç²¾ç®—å‰©é¤˜åˆ†é…</button>
            <button class="btn-outline" style="margin-top:10px;" onclick="backToPage1()">è¿”å›ä¸»å ±å‘Š</button>
        </div>

        <div class="container hidden" id="page3">
            <h1>Full Report</h1>
            <p style="color:var(--text-secondary); margin-bottom:20px;">è²¡å‹™ç¾æ³ç¸½å½™æ•´</p>
            
            <div id="full-report-content" class="full-report"></div>
            
            <button class="btn" style="margin-top:20px;" onclick="backToPage1FromReport()">è¿”å›ä¸»å ±å‘Š</button>
        </div>

    </div>

    <script>
        let globalIncome = 0, userHasDebt = 'no', userHasFund = 'no', debtData = [];
        let budgetChart = null; // åœ–è¡¨å¯¦ä¾‹
        const IG_VIDEO_URL = "https://www.instagram.com/reel/DTP7iSMgagR/?utm_source=ig_web_button_share_sheet&igsh=MzRlODBiNWFlZA==";

        function toggleDebtSection() {
            const has = document.getElementById('hasDebt').value;
            document.getElementById('debt-input-group').style.display = (has === 'yes') ? 'block' : 'none';
            document.getElementById('emergency-fund-group').style.display = (has === 'no') ? 'block' : 'none';
        }

        function addDebt() {
            const div = document.createElement('div'); div.className = 'debt-item';
            div.innerHTML = `<div class="debt-grid"><div><div class="grid-label">é …ç›®åç¨±</div><input type="text" class="d-name"></div><div><div class="grid-label">å¹´åˆ©ç‡ %</div><input type="number" step="0.1" class="d-rate"></div><div><div class="grid-label">æ¯æœˆç¹³æ¬¾</div><input type="number" class="d-pay"></div><div><div class="grid-label">å‰©é¤˜æœŸæ•¸</div><input type="number" class="d-months"></div></div>`;
            document.getElementById('debt-list').appendChild(div);
        }

        function addFixedExp() {
            const div = document.createElement('div'); div.className = 'debt-item';
            div.innerHTML = `<div class="debt-grid"><div><div class="grid-label">æ”¯å‡ºé …ç›®</div><input type="text" class="f-name"></div><div><div class="grid-label">é‡‘é¡</div><input type="number" class="f-pay"></div></div>`;
            document.getElementById('fixed-exp-list').appendChild(div);
        }

        function processDiagnosis() {
            userHasDebt = document.getElementById('hasDebt').value;
            userHasFund = (userHasDebt === 'no') ? document.getElementById('hasEmergencyFund').value : 'no';
            globalIncome = parseFloat(document.getElementById('monthlyIncome').value) || 0;
            if (globalIncome <= 0) return alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„æœˆæ”¶å…¥é‡‘é¡å–”ï¼");

            document.getElementById('quiz-form').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');

            const overviewArea = document.getElementById('debt-overview-area'), diagArea = document.getElementById('diagnosis-area'), budgetArea = document.getElementById('budget-area'), actionArea = document.getElementById('result-action'), overBtn = document.getElementById('over50-btn'), summaryBtn = document.getElementById('summary-report-btn');
            
            overviewArea.innerHTML = ""; diagArea.innerHTML = ""; budgetArea.innerHTML = ""; actionArea.innerHTML = "";
            overBtn.classList.remove('hidden'); summaryBtn.classList.add('hidden'); debtData = [];

            if (userHasDebt === 'no') {
                diagArea.innerHTML = `<div class="diag-box low-debt-info">âœ¨ <b>æ­å–œä½ ç›®å‰æ²’æœ‰è² å‚µï¼</b><br>é€™æ˜¯ä¸€å€‹éå¸¸æ£’çš„é–‹å§‹ã€‚æŒçºŒä¾ç…§ä¸‹æ–¹çš„ã€Œç†æƒ³é ç®—ã€åˆ†é…ï¼Œå¦³å¾ˆå¿«å°±èƒ½ç´¯ç©å‡ºåšå¯¦çš„è²¡å¯Œåº•æ°£ã€‚</div>`;
                renderBudget(globalIncome, budgetArea, userHasFund, false, false);
                // æ¨è–¦è™•æ–¹ç±¤ï¼šå­˜éŒ¢å·¥å…·
                actionArea.innerHTML = `<a href="https://drive.google.com/drive/folders/1uPoV-RN33p4hZY11cD_rFo2x-Fv4jkjG?usp=drive_link" target="_blank" class="action-btn">ğŸ é ˜å–è²¡å¯Œåº•æ°£ PDF</a><a href="${IG_VIDEO_URL}" target="_blank" class="action-btn video-btn">ğŸ“º è§€çœ‹æ•™å­¸å½±ç‰‡</a>`;
            } else {
                summaryBtn.classList.remove('hidden');
                const rates = document.getElementsByClassName('d-rate'), pays = document.getElementsByClassName('d-pay'), names = document.getElementsByClassName('d-name'), months = document.getElementsByClassName('d-months');
                let totalMonthlyDebtPay = 0, highDebts = [];
                
                for (let i = 0; i < rates.length; i++) {
                    let p = parseFloat(pays[i].value) || 0, r = parseFloat(rates[i].value) || 0, m = parseFloat(months[i].value) || 0, n = names[i].value || `é …ç›®${i+1}`;
                    totalMonthlyDebtPay += p;
                    let totalPay = p * m, estInterest = totalPay - (totalPay / (1 + (r * m / 2400)));
                    debtData.push({name: n, rate: r, pay: p, month: m, totalDebt: totalPay, savedInterest: estInterest});
                    if (r >= 5) highDebts.push(n);
                }
                let debtRatio = (totalMonthlyDebtPay / globalIncome) * 100;
                overviewArea.innerHTML = `<div class="debt-summary-card"><div class="summary-item"><span class="summary-label">æ¯æœˆé‚„å‚µç¸½é¡</span><span class="summary-value">$${totalMonthlyDebtPay.toLocaleString()}</span></div><div class="summary-item"><span class="summary-label">å‚µå‹™ä½”æ”¶å…¥æ¯”</span><span class="summary-value">${debtRatio.toFixed(1)}%</span></div></div>`;
                
                if (debtRatio > 5) overBtn.classList.add('hidden');
                
                if (highDebts.length > 0) {
                    diagArea.innerHTML += `<div class="diag-box high-debt-warning">ğŸ¥ <b>è¨ºæ–·çµæœï¼šåµæ¸¬åˆ°é«˜åˆ©è² å‚µ Bugï¼</b><br>é‡å° <span style="font-weight:bold; color:var(--danger);">${highDebts.join('ã€')}</span>ï¼Œè«‹å„ªå…ˆå…¨åŠ›é‚„æ¬¾ï¼Œé¿å…åˆ©æ¯åƒæ‰å¦³çš„åº•æ°£ï¼</div>`;
                    
                    // Bear è™•æ–¹ç±¤ï¼šæ¨è–¦è¨˜å¸³æœ¬
                    actionArea.innerHTML = `
                        <div class="prescription-box">
                            <div class="prescription-title"><i class="fas fa-medkit"></i> Bear é†«å¸«è™•æ–¹ç±¤</div>
                            æª¢æ¸¬åˆ°é«˜åˆ©å‚µå‹™ï¼å»ºè­°ç«‹åˆ»ä½¿ç”¨ã€åŸå‰µè¨˜å¸³æœ¬ã€‘çš„å‚µå‹™é›ªçƒé é¢ä¾†æ­¢è¡€ã€‚
                        </div>
                        <a href="https://myship.7-11.com.tw/general/detail/GM2502152714662" target="_blank" class="action-btn">ğŸ“š å–å¾—åŸå‰µè¨˜å¸³æœ¬ãƒ»ç²¾æº–æ­¢è¡€</a>`;
                } else {
                    renderBudget(globalIncome, budgetArea, 'no', true, true);
                    actionArea.innerHTML = `<a href="https://drive.google.com/drive/folders/1uPoV-RN33p4hZY11cD_rFo2x-Fv4jkjG?usp=drive_link" target="_blank" class="action-btn">ğŸ é ˜å–è²¡å¯Œåº•æ°£ PDF</a><a href="${IG_VIDEO_URL}" target="_blank" class="action-btn video-btn">ğŸ“º è§€çœ‹æ•™å­¸å½±ç‰‡</a>`;
                }
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderBudget(income, container, hasFund, isDebtMode, isLowDebt) {
            let f, v, pre, e, s, i;
            let labels = [], data = [], colors = [];

            if (isDebtMode && isLowDebt) {
                f = 0.60; v = 0.20; pre = 0.10; e = 0.05; s = 0; i = 0.05;
            } else if (hasFund === 'no') {
                f = 0.5; v = 0.2; pre = 0.1; e = 0.1; s = 0.05; i = 0.05;
            } else {
                f = 0.5; v = 0.2; pre = 0.1; e = 0; s = 0.15; i = 0.05;
            }
            
            // æº–å‚™åœ–è¡¨æ•¸æ“š
            const categories = [
                { label: 'å›ºå®šæ”¯å‡º', pct: f, color: '#5a4d41' },
                { label: 'è®Šå‹•æ”¯å‡º', pct: v, color: '#b08d85' },
                { label: 'é å­˜æ”¯å‡º', pct: pre, color: '#d4a373' },
                { label: 'ç·Šæ€¥é å‚™', pct: e, color: '#e57373' },
                { label: 'å„²è“„æŠ•è³‡', pct: s, color: '#81c784' },
                { label: 'æŠ•è³‡è‡ªå·±', pct: i, color: '#ffd54f' }
            ];

            let html = `<div class="budget-card"><div style="font-weight:600; font-size:1.1rem; margin-bottom:5px; color:var(--text-primary);">ğŸ’¡ Bear çš„ç†æƒ³é ç®—åˆ†é…</div>
            <div class="chart-container"><canvas id="budgetChart"></canvas></div>`;
            
            categories.forEach(cat => {
                if (cat.pct > 0) {
                    html += `<div class="budget-row"><span style="display:flex; align-items:center;"><span style="display:inline-block; width:10px; height:10px; background:${cat.color}; border-radius:50%; margin-right:8px;"></span>${cat.label} (${Math.round(cat.pct*100)}%)</span><b>$${Math.round(income*cat.pct).toLocaleString()}</b></div>`;
                    labels.push(cat.label);
                    data.push(Math.round(income * cat.pct));
                    colors.push(cat.color);
                }
            });
            html += `</div>`;
            container.innerHTML = html;

            // ç¹ªè£½åœ–è¡¨
            setTimeout(() => {
                const ctx = document.getElementById('budgetChart').getContext('2d');
                if (budgetChart) budgetChart.destroy();
                
                budgetChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: colors,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }, // éš±è—å…§å»ºåœ–ä¾‹ï¼Œä½¿ç”¨ä¸‹æ–¹è‡ªå®šç¾©åˆ—è¡¨
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return ` $${context.raw.toLocaleString()}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }, 100);
        }

        function showFullReport() {
            document.getElementById('page1').classList.add('hidden');
            document.getElementById('page3').classList.remove('hidden');
            const content = document.getElementById('full-report-content');
            let totalMonthly = 0; debtData.forEach(d => totalMonthly += d.pay);
            let ratio = ((totalMonthly / globalIncome) * 100).toFixed(1);

            let html = `
                <div class="report-row"><span class="report-title">æ¯æœˆç¸½æ”¶å…¥</span><span>$${globalIncome.toLocaleString()}</span></div>
                <div class="report-row"><span class="report-title">æ¯æœˆå‚µå‹™ç¸½é¡</span><span style="color:var(--danger); font-weight:bold;">$${totalMonthly.toLocaleString()}</span></div>
                <div class="report-row"><span class="report-title">å‚µå‹™ä½”æ¯”</span><span style="color:var(--danger); font-weight:bold;">${ratio}%</span></div>
                <h4 style="margin: 25px 0 10px 0; color:var(--text-primary); border-bottom:2px solid var(--accent); padding-bottom:5px;">ğŸ“Œ è² å‚µé …ç›®æ˜ç´°</h4>
                <div class="debt-table-wrapper">
                    <table class="debt-table">
                        <tr><th>é …ç›®(åˆ©ç‡)</th><th>æœˆç¹³</th><th>æœŸæ•¸</th><th>ç¸½æ¬ æ¬¾</th><th>é‚„å®Œçœä¸‹åˆ©æ¯</th></tr>`;
            debtData.forEach(d => {
                html += `<tr><td>${d.name}<br>(${d.rate}%)</td><td>$${d.pay.toLocaleString()}</td><td>${d.month}æœŸ</td><td>$${Math.round(d.totalDebt).toLocaleString()}</td><td class="save-money">$${Math.round(d.savedInterest).toLocaleString()}</td></tr>`;
            });
            html += `</table></div>`;
            content.innerHTML = html;
        }

        function showSurvivalPage() { document.getElementById('page1').classList.add('hidden'); document.getElementById('page2').classList.remove('hidden'); }
        function backToPage1() { document.getElementById('page2').classList.add('hidden'); document.getElementById('page1').classList.remove('hidden'); }
        function backToPage1FromReport() { document.getElementById('page3').classList.add('hidden'); document.getElementById('page1').classList.remove('hidden'); }
        
        function calcSurvival() {
            const pays = document.getElementsByClassName('f-pay');
            let totalFixed = 0; for (let p of pays) totalFixed += parseFloat(p.value) || 0;
            const remaining = globalIncome - totalFixed, resBox = document.getElementById('survival-result'); resBox.style.display = "block";
            
            if (remaining < 0) { 
                resBox.innerHTML = `âš ï¸ <b>åš´é‡è­¦å ±ï¼š</b><br>å¦³çš„å›ºå®šæ”¯å‡ºå·²ç¶“è¶…éæ”¶å…¥äº†ï¼ç¼ºå£ç‚º <span style="color:var(--danger); font-weight:bold;">$${Math.abs(remaining).toLocaleString()}</span>ã€‚è«‹å‹™å¿…é‡æ–°æª¢è¦–æ”¯å‡ºé …ç›®ã€‚`; 
            } else { 
                let html = `ğŸ“Œ <b>å¯åˆ†é…é¤˜é¡ï¼š</b> <span style="font-size:1.2rem; font-weight:bold; color:var(--text-primary);">$${remaining.toLocaleString()}</span>`;
                if (userHasDebt === 'no' && userHasFund === 'yes') 
                    html += `<br><br>âœ¨ é›–ç„¶å›ºå®šæ”¯å‡º > 50%ï¼Œä½†å› ç‚ºå¦³ç„¡è² å‚µä¹Ÿå­˜æ»¿äº†é å‚™é‡‘ï¼Œç‹€æ³å·²ç¶“è´é 90% çš„äººå›‰ï¼<br>å‰©é¤˜çš„éŒ¢æ‰£é™¤è®Šå‹•æ”¯å‡ºèˆ‡é å­˜é …ç›®å¾Œï¼Œå¯å…¨æ•¸æŠ•å…¥å„²è“„æˆ–æŠ•è³‡ã€‚`; 
                else 
                    html += `<br><br>âš ï¸ å»ºè­°å¼·åˆ¶æŠ½å– 5% = <b>$${Math.round(globalIncome*0.05).toLocaleString()}</b> å…ˆå­˜èµ·ä¾†ç•¶é å‚™é‡‘ï¼Œå‰©ä¸‹çš„å†åšåˆ†é…ã€‚`; 
                resBox.innerHTML = html; 
            }
        }
    </script>
</body>
</html>
